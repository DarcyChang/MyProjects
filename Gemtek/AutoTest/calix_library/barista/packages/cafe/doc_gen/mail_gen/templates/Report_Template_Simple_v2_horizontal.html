<!DOCTYPE html>
<html>
<head>
    <title>Simple templates for render test report</title>

    <style>
        td {
        height: 11pt
        font-size: 12px
        }

    </style>

</head>
<body>

{%set list_size = sum_list|length()%}
{%if list_size >= 2%}
{% set current_sum = sum_list[-1]%}
{% set previous_sum = sum_list[-2]%}
{%elif list_size ==1%}
{% set current_sum = sum_list[0]%}
{% set previous_sum = []%}
{%endif%}

{% macro filldata(name, key) -%}
{% if name is defined %}
{% set value = name|attr(key) %}
{{ value }}
{% endif %}
{%- endmacro %}
<div id="Report_Template_v1_16690" align=center>
    <table border="1" width="90%" style='border-collapse:collapse; table-layout:fixed;
    text-align: center;'>

        <tr bgcolor="DeepSkyBlue">
            <td colspan=14 align=center><b> {{ filldata(current_sum,'report_title') }}</b></td>
        </tr>
        <tr>
            <td colspan="1" bgcolor="#D9E1F2"></td>
            <td colspan="2" bgcolor="#BFBFBF">Previous</td>
            <td colspan="2" bgcolor="#BFBFBF">Current</td>

            <td colspan="2" bgcolor="#D9E1F2"></td>
            <td colspan="2" bgcolor="#BFBFBF">Previous</td>
            <td colspan="2" bgcolor="#BFBFBF">Current</td>

            <td rowspan=6 bgcolor="#92D050">Pass Rate</td>
            <td bgcolor="#BFBFBF">Previous</td>
            <td bgcolor="#BFBFBF">Current</td>

        </tr>
        <tr>
            <td colspan="1" bgcolor="#A9D08E" style="text-align: left;padding-left: 10px">Build ID</td>
            <td colspan="2">{{ filldata(previous_sum,'dut') }}</td>
            <td colspan="2">{{ filldata(current_sum,'build_id') }}</td>

            <td colspan="2" bgcolor="#A9D08E" style="text-align: left;padding-left: 10px">Branch</td>
            <td colspan="2">{{ filldata(previous_sum,'branch_id') }}</td>
            <td colspan="2">{{ filldata(current_sum,'branch_id') }}</td>

            <td rowspan=5 bgcolor="#92D050">{{filldata(previous_sum,'total_pass_rate') }}</td>
            <td rowspan=5 bgcolor="#92D050">{{filldata(current_sum,'total_pass_rate') }}</td>

        </tr>
        <tr>
            <td colspan="1" bgcolor="#A9D08E" style="text-align: left;padding-left: 10px">
                Total Number of Test Cases
            </td>
            <td colspan="2">
                {{ filldata(previous_sum,'total_case_number') }}
            </td>
            <td colspan="2">
                {{ filldata(current_sum,'total_case_number') }}
            </td>

            <td colspan="2" bgcolor="#A9D08E" style="text-align: left;padding-left: 10px">Start Time
            </td>
            <td colspan="2">
                {{ filldata(previous_sum,'test_start_time') }}
            </td>
            <td colspan="2">
                {{ filldata(current_sum,'test_start_time') }}
            </td>
        </tr>

        <tr>
            <td colspan="1" bgcolor="#A9D08E" style="text-align: left;padding-left: 10px">
                Test Cases Passed
            </td>
            <td colspan="2">
                {{ filldata(previous_sum,'case_pass_number') }}
            </td>
            <td colspan="2">
                {{ filldata(current_sum,'case_pass_number') }}
            </td>

            <td colspan="2" bgcolor="#A9D08E" style="text-align: left;padding-left: 10px">
                Finish Time
            </td>
            <td colspan="2">
                {{ filldata(previous_sum,'test_stop_time') }}
            </td>
            <td colspan="2">
                {{ filldata(current_sum,'test_stop_time') }}
            </td>

        </tr>

        <tr>
            <td colspan="1" bgcolor="#A9D08E" style="text-align: left;padding-left: 10px">
                Test Cases Failed
            </td>
            <td colspan="2">
                {{ filldata(previous_sum,'case_fail_number') }}
            </td>
            <td colspan="2">{{ filldata(current_sum,'case_fail_number') }}</td>

            <td colspan="2" bgcolor="#A9D08E" style="text-align: left;padding-left: 10px">
                Total Execution Time
            </td>
            <td colspan="2">
                {{ filldata(previous_sum,'test_execution_time')|convert_seconds }}
            </td>
            <td colspan="2">{{ filldata(current_sum,'test_execution_time')|convert_seconds }}
            </td>

        </tr>

        <tr>
            <td colspan="1" bgcolor="#A9D08E" style="text-align: left;padding-left: 10px">
                Test Cases Skipped
            </td>
            <td colspan="2">{{ filldata(previous_sum,'case_skip_number') }}</td>
            <td colspan="2">{{ filldata(current_sum,'case_skip_number') }}</td>

            <td colspan="2" bgcolor="#A9D08E" style="text-align: left;padding-left: 10px">
                Average Time Per Test
            </td>
            <td colspan="2">{{ filldata(previous_sum,'case_average_time') }}
            </td>
            <td colspan="2">{{ filldata(current_sum,'case_average_time') }}</td>

        </tr>

        <tr>
            <td colspan=14 style='border-right:1.0pt solid black;' bgcolor=red align=center>
                <b>Failure Analysis</b>
            </td>
        </tr>


        <tr>
            <td colspan="1" rowspan="2" bgcolor="#D9E1F2">Functional
                area
            </td>
            <td colspan=2 bgcolor="#D9E1F2" align='center'>Test Cases Passed</td>
            <td colspan=2 bgcolor="#D9E1F2" align='center'>Test Cases Failed</td>
            <td colspan=2 bgcolor="#D9E1F2" align='center'>Test Cases Skipped</td>
            <td colspan=2 bgcolor="#D9E1F2" align='center'>Pass Rate</td>
            <td colspan=5 bgcolor="#D9E1F2">Comments</td>
        </tr>
        <tr>
            <td bgcolor="#BFBFBF">Previous</td>
            <td bgcolor="#BFBFBF">Current</td>

            <td bgcolor="#BFBFBF">Previous</td>
            <td bgcolor="#BFBFBF">Current</td>

            <td bgcolor="#BFBFBF">Previous</td>
            <td bgcolor="#BFBFBF">Current</td>

            <td bgcolor="#BFBFBF">Previous</td>
            <td bgcolor="#BFBFBF">Current</td>

            <td bgcolor="#BFBFBF" colspan="3">Previous</td>
            <td bgcolor="#BFBFBF" colspan="2">Current</td>

        </tr>

        {% macro fill_tag_data(tag, name) -%}
        {% if tag %}
        {{tag.get(name)|e}}
        {% endif %}
        {%- endmacro %}

        {% macro dump_tag(previous_tag, tag) -%}
        <tr>
            <td bgcolor="#D9E1F2">{{tag.get('tag')}}</td>
            <td>{{fill_tag_data(previous_tag, 'tag_passed_number')}}</td>
            <td>{{fill_tag_data(tag,'tag_passed_number')}}</td>
            <td>{{fill_tag_data(previous_tag, 'tag_failed_number')}}</td>
            <td>{{fill_tag_data(tag,'tag_failed_number')}}</td>
            <td>{{fill_tag_data(previous_tag, 'tag_skipped_number')}}</td>
            <td>{{fill_tag_data(tag,'tag_skipped_number')}}</td>
            <td>{{fill_tag_data(previous_tag, 'tag_passed_rate')}}</td>
            <td>{{fill_tag_data(tag,'tag_passed_rate')}}</td>
            <td colspan="3">{{fill_tag_data(previous_tag, 'tag_comments')}}</td>
            <td colspan="2">{{fill_tag_data(tag,'tag_comments')}}</td>
        </tr>
        {%- endmacro %}

        {% set list_size = tag_list|length() %}
        {% if list_size >= 2 %}
        {% set current_tags = tag_list[-1] %}
        {% set previous_tags = tag_list[-2] %}
        {% elif list_size ==1 %}
        {% set current_tags = tag_list[0] %}
        {% set previous_tags = [] %}
        {% endif %}

        <!--setup old tag and current tag data structure-->
        {% for tag in current_tags.get('FEATURE') %}
        {% if previous_tags %}
        {% for old_tag in previous_tags.get('FEATURE') %}
        {% if old_tag.get('tag') == tag.get('tag') %}
        {{ dump_tag(old_tag, tag) }}
        {% endif %}
        {% endfor %}
        {% else %}
        {{ dump_tag(Null, tag) }}
        {% endif %}
        {% endfor %}

    </table>

    <p align="center">Check console output at <a href="{{ filldata(current_sum,'result_url') }}">{{ filldata(current_sum,'result_url') }}</a> to view the results.</p>

</body>
</html>
